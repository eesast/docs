---
title: Rust
---

## 简介

一言以蔽之，Rust 是一门旨在开发安全且高性能程序的语言。

目前，Rust 有以下优缺点：

- 内存安全：几乎大部分操作内存的函数都有关于内存的边界检查，不安全的操作都需要显式的 `unsafe` 关键字
- 高性能：没有垃圾回收的编译型语言，性能可与 C / C++ [比肩](https://benchmarksgame-team.pages.debian.net/benchmarksgame/which-programs-are-fastest.html)，[内存和能源效率](https://dl.acm.org/doi/10.1145/3136014.3136031)也很好
- 强大的类型系统，防止[数据竞争](https://doc.rust-lang.org/nomicon/races.html)，甚至[“无畏并发”](https://blog.rust-lang.org/2015/04/10/Fearless-Concurrency.html)
- 较优质的开发工具链：从 Web 开发等工程实践中学习而来的工具链经验造就了 Rust 使用的 `Cargo` `clippy` `rustup`
- 陡峭的学习曲线：替代 C / C++ 程序员自主管理的内存，引入了 `lifetime` 等概念，使学习曲线更加陡峭
- 在某些领域或目标平台 (尤其是嵌入式开发) ，缺少 Rust 原生库，比其他类似语言编译时间更长。参见[为什么不使用 Rust](https://blog.rust-lang.org/2020/04/17/Rust-survey-2019.html#why-not-use-rust)

如果你想开始使用 Rust 进行开发：

- 从 [**rustup.rs**](https://rustup.rs/) 下载安装程序 (对于任何平台都强烈推荐从这获取安装包)
- 安装一个 IDE:
  - [IntelliJ](https://www.jetbrains.com/idea/) (免费) 或 [CLion](https://www.jetbrains.com/clion/) (付费) 与 [**IntelliJ Rust**](https://intellij-rust.github.io/)
  - [Visual Studio Code](https://code.visualstudio.com/) 与 [**rust-analyzer**](https://rust-analyzer.github.io/)
- 查看本页面上的链接， 更多 [学习资料](https://www.rust-lang.org/learn) 和 [**去哪里问问题**](https://www.rust-lang.org/community)

相关链接：

- [官网](https://www.rust-lang.org/)
- [官方仓库](https://github.com/rust-lang/rust)
- [中文社区](https://rustcc.cn/)

## 安装

我推荐参照 [Rust 入门](https://www.rust-lang.org/zh-CN/learn/get-started)中所写的安装 `Rustup` 和 `Cargo`。安装好后可以根据 [tuna 镜像](https://mirrors.tuna.tsinghua.edu.cn/help/crates.io-index.git/)进行换源。

`Rustup` 是 `Rust` 的安装器和版本管理工具，可以使用它安装需要的 `Rust` 版本，例如在 Windows 上可以根据需要安装 gnu 或者 msvc 版。

`Cargo` 是构建工具和包管理器，对 Web 开发比较熟悉的可以理解为 `Rust` 的 `npm` 或 `yarn`。在安装 `Rustup` 时将会一并安装，不需要手动处理。

如果使用 `Visual Studio Code` 进行开发，推荐安装以下插件：

- `bungcip.better-toml` 用来高亮 `Rust` 的 `Toml` 格式配置文件
- `vadimcn.vscode-lldb` 用来调试
- `matklad.rust-analyzer` 提供语义高亮
- `rust-lang.rust` 基于 `Rust` 的构建工具提供大部分功能，如调用 `Cargo fmt` 进行格式化

> 目前（2021-1）rust-analyzer 还未集成到 rls（rust language server）中，同时使用 rust-analyzer 和 rust 插件的 rls 会有一些冲突，不过实际开发中似乎影响并不是特别大。

## Hello World: 构建 Rust 的基本流程

绝大多数情况下，我们使用 `Cargo` 构建 `Rust` 项目，而这会大量使用命令行执行 `Cargo`。

在命令行中，使用以下指令初始化一个名为 `hello-world` 的项目并进入该项目的根目录：

```bash
cargo new hello-world
cd hello-world
```

或者

```bash
mkdir hello-world
cargo init
```

创建好的项目具有如下结构：

```
hello-world
 └──.git/
 │  └────...
 ├──.gitignore
 ├──Cargo.toml
 └──src/
 │  └────main.rs
```

显然，`Cargo` 已经创建了一个可以使用 `Git` 管理的文件夹，其中 `.gitignore` 内容为：

```
/target
```

这是 `Rust` 默认的编译后的产物所在的文件夹。

`Cargo.toml` 是此项目的配置文件，内容为：

```toml
[package]
name = "hello-world"
version = "0.1.0"
authors = ["Author <author@example.com>"]
edition = "2018"

# See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html

[dependencies]
```

这里记录了项目的名称、版本、作者、使用的 `Rust` 版本和依赖。依赖管理参加后文。

在 `src` 中是项目的代码，一个新初始化的项目只有 `main.rs`，其中内容为：

```rust
fn main() {
    println!("Hello, world!");
}
```

这便是一个 `main` 函数，输出一句 `Hello, world!`。我们可以使用 `cargo run` 来编译并运行这三行代码。

```bash
>>> cargo run
   Compiling hello-world v0.1.0 (your/path/to/hello-world)
    Finished dev [unoptimized + debuginfo] target(s) in 1.69s
     Running `your/path/to/hello-world/target/debug/hello-world.exe`
Hello, world!
```

在开发过程中，可以使用 `cargo clippy` 进行代码风格的检查并根据提示进行优化，可以使用 `cargo test` 对代码内定义的 `test` 函数进行检查（参加后文中测试的部分）。最终可以使用 `cargo build --release` 编译为优化后的二进制程序。

## Rust 基本语法
