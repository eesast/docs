---
title: 规则手册
sidebar_label: 规则手册
---

# 清华大学第二届人工智能挑战赛

# 暨电子系第二十届队式程序设计大赛

# 《枪林弹雨》参赛手册

## 一、比赛简介

​	本届比赛赛题为“枪林弹雨”，设计思路主要来自于去年风靡一时的游戏《绝地求生大逃杀》，同时也引入了一些新的设定。

### 整体流程

​	比赛在一个巨大的岛屿上展开，刚开始时会有一架飞越全地图的飞船，选手们将选择着陆地点后从飞船上调到目的地，然后收集地图上的随机物资来强大自己的实力，与其他队伍的选手进行枪斗。与此同时会有一个能对选手造成持续伤害的强大的电场自岛屿外收敛到岛屿中某个点，选手需要和电场进行赛跑以博得优势，一定时间后整个地图都将被电场覆盖以迫使选手决出胜负。

### 设计亮点

1. 多人AI混战：比赛以队伍的形式参赛，每支队伍至多四人，每一场比赛至多十六支队伍同时上场，最多六十四个AI同线作战的模式突破了以往电子系队式比赛一对一的架构束缚，人数导致的复杂度上升为参赛选手带来了更多的策略与乐趣，比赛不再是简单的博弈。
2. 随机物资模式：比赛在地图已知情况下，给出了带权随机的物资分布，选手需要根据即使情况随机应变，在风险与期望间抉择。多玩家与随机性决定了比赛不大可能出现了一个最优算法，但是一个好的路径规划算法无疑有可能带来压倒性的物资优势。
3. 数十种物品：地图上的物资包括武器、防具、道具，共计有几十种之多，玩家需要先收集物资后根据不同物品的特点合理使用，伤害型、防御型、恢复性、辅助型均有，只有合理发挥了各个物品的作用，才能在枪斗中取得优势。
4. 职业系统：每支队伍的四人必须从四个不同的职业(医疗兵/通信兵/狙击手/黑客)中进行选择，且队友不得选择相同职业，不同职业的职业技能将对比赛造成不小的影响，队员间需要利用各自的特有技能进行协同合作，确定自身定位，博得比赛中的竞争优势。同时也由于不同职业的定位不同，一定程度上鼓励了选手以队伍形式参赛(当然原则上也接受一个人写出一支队伍的AI参赛:D)。
5. 视觉与听觉：比赛在二维地图上展开，选手将有一个扇形区域的视野来获取环境信息，比赛采用了仿FPS游戏的视野并将其数字化，选手将需要对视野盲区可能出现的危险做好预防。同时枪声、脚步声也将成为重要的信息来源。特别的，比赛中加入了无线电系统，选手的AI将通过无线电与队友进行通信。
6. 地图设定：地图上有森林、海滩、城镇、农田等不同的区域，每个区域内又有树木、草丛、浅滩、建筑等不同的环境物体，这些环境物体将对视野、弹道甚至是脚步声造成影响，选手需要利用地形隐蔽自己，同时预防来自角落的可能的突袭。

## 二、赛题背景

​	一方神秘的世界猝然出现于此，一群天外来客不知自何而来。几十名空手而来的掠夺精英从轰鸣而来的飞船跳到了场上，虽然没有斩草为马、撒豆成兵的神力，但这遍地的装备仿佛在推动着这群不速之客决一死战。

​	猎人与猎物与你，一并出现在这里，但这个世界法则只允许猎人与猎物存在，只允许猎人活到最后——而且是最为老练的猎人。

​	远方，诡异的电场咆哮着奔来；近处，敌人已经拾起了防弹衣与重机枪。犹豫着死去，还是挣扎着反杀，你，需要和你的队友一同做出选择……

## 三、比赛规则

​	《枪林弹雨》是多队伍混战模式的2DFPS比赛，每支参赛队伍需要提交至多四份AI代码(对应四个职业)参加比赛，每场比赛至多十六支队伍同时参赛，地图规格为1000*1000，选手需要争夺地上散步的物资，通过拾起的武器击杀对手，比赛成绩将由存活排名与击杀数量两方面决定。

​	比赛进行的时间单位用“帧”来衡量，一帧可以映射为现实时间的500ms，但选手AI一帧内的决策时间只有50ms，以下是对规则的详细介绍(注：详细数据参见另外给出的数据手册，规则部分除了一些基本数据外不会给出具体参数)。

### (1)指令

​	玩家的指令接口包括**移动**、**攻击**、**拾取**、**无线电**。一个指令执行后可能需要不止一帧的时间（**CD**）执行该指令，如开枪后一定时间内无法再次接受攻击指令，AI需要分析局面，合理发送指令来博取优势、取得胜利。发送一次指令时，需要指明指令名、给定该指令的相关参数，无效的参数和指令也将被无视，且<u>同一回合相同指令一般只能发送一条，如果违背则采用后来居上的原则</u>。

| 做......时 | 移动 | 攻击 | 拾取 | 无线电 |
| ---------- | ---- | ---- | ---- | ------ |
| 试图移动   | 覆盖 | 允许 | 无效 | 允许   |
| 试图攻击   | 允许 | 无效 | 无效 | 允许   |
| 试图拾取   | 打断 | 打断 | *    | 允许   |
| 试图无线电 | 允许 | 允许 | 允许 | *      |

解释：

- 一般指令采用“执行后出现CD”的原则，比如某种武器攻击的CD如果是5，那么在发出指令后子弹就会射出，但是之后5帧内玩家无法执行任何攻击指令。移动与攻击有指令，拾取与无线电都是单帧完成；
- 同一回合发送多条相同类型指令将采取后覆盖前的原则；
- 拾取指令执行帧其他所有指令无效，移动、攻击若正在执行则被拾取打断（但是CD并未消失），在拾取结束后恢复原来状态(如果CD仍未结束)。
- 攻击CD时新的攻击指令直接被无视；
- 移动时可以用新的移动打断原来的，这个行为有利有弊，详见移动部分。
- 选手可以通过查看自身的状态(status)及上表来判断可以执行哪些操作，通过查看各个CD合理规划。

以下是各个指令详解：

#### a.移动

**简介**

​	移动是一个3CD的指令，移动方向将由移动角度指令决定，移动速度（每次移动指令移动距离）因职业而异，影响移动速度的要素见后，移动时遇到障碍物（地形、角色、道具）自动停止，视野朝向由面向角度指定，下一帧角色将**视线**将调整到该方向。特别的，在飞机上或者跳伞时移动指令将无效。移动指令后的三帧内分别移动不同距离，第二帧移动距离最大，玩家可以通过及时更新指令调整移动节奏。

**指令参数**

1. 移动角度：一个`float`量，应当不小于**0**且不超过**360**，采用角度制，以视线为基准。
2. 面向角度：一个`float`量，应当不小于**0**且不超过**360**。
3. 附带参数：一个`int`量，当给定附带参数为0时，表示只改变面向角度，不改变移动状态。需注意设为0是保持移动状态，不能用于停止移动，若原来在移动，移动的绝对角度不会改变。

#### b.攻击

**简介**

​	发送攻击指令后将使用指定武器朝指定方位进行攻击，攻击应当指明用来攻击的武器编号，攻击角度，以及可能有的特殊参数。攻击指令一定会有CD，由武器决定，不合法的攻击指令同样被无视。

**指令参数**

1. 攻击角度：一个`float`量，取值范围为[0, 360)，计算方法是相对**视线角度**逆时针转过的角度。
2. 武器ID：一个`unsigned int`量，指明自己用来攻击的武器的索引号。
3. 特殊参数：一个`int`（宏）量，(暂时)只对医疗兵对队友用药品时有效，医疗兵为队友用药品时应当使用这个参数指定队友ID。

**补充**

​	关于攻击的模型，这里给一个简述。首先攻击没有友军伤害，子弹将直接无视友军，寻找最近的攻击范围内的敌人。如无特殊说明，所有子弹飞行速度均足以在一帧里击中目标，因此无需考虑子弹飞行。武器参数中有一项参数叫散角，这就意味着子弹飞出时可以认为是朝一个扇形区域非等可能地飞出，在该范围内的敌人都在可击中范围之内，但是实际受到的伤害需要在武器基础伤害上乘以一个系数$e^{-Ax^2/d}$，其中$d$为武器的攻击距离，$x$为被击中目标到子弹实际出射轨迹直线的距离，$A$为一个隐含因子，这个因子保证了当距离较远时子弹命中率会更高，但如果实际偏离很远(超过一个身位)的话伤害会下降到一个可以忽略的程度。

#### c.拾取

**简介**

​	当角色**视野**内有可拾取的物品时，可以通过发送拾取指令来捡起目标物品，需要指定物品ID，拾取本身无CD，但是某些特殊即捡即用物品可能会产生使用CD（详见[物品](#(3)物品) 部分）。对于某些特殊物品可能需要用到附加参数。不合法的拾取指令将被无视，同一回合内不同角色拾取同一物品将随机决定一个人拾取成功。

**指令参数**

1. 物品ID：一个`unsigned int`量，指明操作对象的物品ID，如果指定ID不是拾取范围内的物品，会被无视。
2. 附加参数：一个`int`量，某些特殊物品需要用到(暂时不会用到)。

#### d.无线电

**简介**

​	无线电指令是本游戏团队合作的精髓，借助我们封装好的接口，玩家可以给队友发送一些如“按兵不动”、“撤退”等无线电消息，并且接收者可以获取发送者ID、坐标、血量等信息，这些消息将被封装在消息结构体里。（如果玩家不满足于给出的无线电，亦可用一个32位整数在自行编码）

**指令参数**

1. 目标ID：一个`unsigned int`量，表示目标的ID。
2. 消息：一个`unsigned char/int`量，作为发送的消息传出。

### (2)感知

#### a.视觉

​	视觉是获取游戏信息的主要途径，每名角色始终有三个关于重要视觉的重要变量:**视线**、**视角**和**视距**。角色的视野为一个扇形区域，视线即扇形的中心线，扇形区域将沿中心线顺逆时针各转视角的半角，我们将视觉可以获取信息的地方称作**视野**。视野范围内可能出现障碍物阻挡视线，玩家的真实可见范围将符合光的直线传播规律。

​	在实际游戏中通常只有视线是AI可以自行决定的，视角和视距都由角色的**职业**、**物品**、所处**地形**等决定，AI只能获取这些参数而不能改变，选手一帧里获取的所有视觉元素保存在几个列表中（分为地形、物品、选手），详见选手接口部分。

#### b.听觉

​	视觉作为主要信息获取途径，通常是AI主动获取，而听觉则是一个被动获取信息的过程。游戏中的听觉信息主要分为两大来源：**环境声音**与**无线电**。获取到的听觉信息会放到一个队列里，如果没有及时获取，则会在下一帧里自动清空。玩家可以通过相关接口获取声音消息来源、内容以及其他信息，AI理应每回合将该队列遍历一遍并做出判断。所有的声音信息均包括**消息**、**发送者**和**时延**，其中消息是一个32位整数承载消息所含的信息，玩家可以通过给定接口解析消息得到一个结构体，发送者是一个`unsigned int`作为信源ID，时延是一个`int`型变量告诉接收者这则消息距离发送过去了多少帧。听觉相关特征如下：

1. 环境声音：信源ID为-1（即0xffffffff），消息中包含声音类型与方向。
2. 无线电：见[无线电](#d.无线电) 部分

| 声音类型 | 发出时机       |
| -------- | :------------- |
| 脚步声   | 移动速度时发出 |
| 枪声     | 子弹出膛时发出 |

关于声音传播的数据见数据手册。

环境声音编码：高三位表示声音类型，低九位表示声源相对接收者的角度(以x轴正向为0度，取值0~360)。

### (3)物品

​	物品是对游戏中各类可获取、可使用物的一个统称，可分为**武器**、**防具**、**道具**。其中，不同的物品属性决定了一个物品的基本特征，而同类物品又有各自独特的属性，这里将详细列出。所有可拾取道具不会阻碍选手移动。

**各类特征**

- 武器：选手用来攻击敌人的物品，装备均有一个值（**弹药量**）来衡量其使用程度，可以等效认为选手已经拥有了所有武器，只是没有弹药，比赛中拾取的武器均体现为相应弹药增加。
- 装备：选手用来减少受到伤害的物品，装备均有一个值（**耐久度**）来衡量其使用程度，可以等效认为选手已经拥有了所有防具，只是全部破损，拾取防具均是对相应防具进行修补。
- 道具：一次性使用的物品，具体种类较多，主要分为使用型、触发型、携带型，使用型与武器体验基本相同，一般为药品，触发型即拾取后立刻生效，不会携带在身上，携带型是携带即生效，一般不可叠加。同样有一个值（**数量**）来衡量使用情况。

### (4)地形

​	地形是指非平地部分的地形，没有任何特性的平地不被考虑为地形（但仍然占有一个位置，作为一些情况下的缺省值）。地形有两种形状，圆形与四边形：圆形地形玩家获取信息可以得到其圆心坐标与半径，以下简称圆；四边形区域玩家可以得到其四个顶点坐标，以下简称方。<u>所有地形均不可被破坏</u>。

​	需要注意的是，实际上的1000*1000大地图被均分为边长100的100个区域块，区域块分为约十种，同种区域内的地形构造**完全相同**(据说原定设计没有这部分，直到界面组开发时遇到了显卡瓶颈:C)，但这不会直接体现给AI，选手可以作为先验知识进行规划，AI可以获取到的只是单个地形信息。

#### a.平地

- 描述：即无地形
- 形状：无
- 特性：无

#### b.树木

- 描述：路边常见的树木，大小不一，常被用作掩体。也不知道这些树是什么做的，大炮都炸不烂……
- 形状：圆
- 特性：可遮挡视野，阻拦子弹，不可通行。

#### c.矮墙

- 描述：高度惊人统一的矮墙，明明看上去是石头，偏偏像钛合金一样坚硬，明明看着不怎么高，偏偏就是翻不过去。
- 形状：方
- 特性：不阻挡视野，但不可通行。

#### d.草丛

- 描述：比矮墙还高的草丛，拿来混淆视听绝对方便。
- 形状：圆或方
- 特性：<u>角色圆心在草丛中时视为角色在草丛中</u>，草丛外的角色无法看见草丛内的角色，但可以通过扫射攻击到潜伏人员。草丛本身会阻碍视线。

#### e.浅滩

- 描述：常在河边走，哪能不湿鞋？早晚都要湿，干脆走进去。
- 形状：方
- 特性：角色圆心在浅滩中时视为在浅滩中，在浅滩移动速度下降30%，有20%概率不被子弹击中（待完成）。

#### f.深水

- 描述：大海无量……哎呀又呛水了！
- 形状：方
- 特性：不可同行。

#### g.建筑

- 描述：荒山野岭的，不知道哪里来的建筑物？
- 形状：方或圆
- 特性：阻挡视线，阻挡子弹，不可通行，一般尺寸较大。

### (5)角色信息

​	角色信息指的AI可以获取的关于自己所操控角色的全部内在信息，包括：HP、HP上限、视线、视角、视距、职业、移动方向、移动速度、移动CD、状态、攻击CD、位置、背包。以下给出这些信息的概念，可见/不可见指其他人能否通过视觉感知到这些信息，需要注意的是可见性对敌人和队友没有差异，需要向队友透露特别信息可用无线电来完成。

- HP：Heal Point，血量，该值一个0到血量上限之间的浮点数，受到伤害后会降低，降至0时角色死亡。除0外不可见。
- HP上限：血量上限，回血时无法突破。
- 视线/视距/视角：见[感知](#(2)感知) 。视线可见，视距与视角不可见。
- 职业：可见。
- 移动方向／移动速度：可见。
- 移动CD／攻击CD：不可见。
- 位置：即角色圆心坐标。可见。
- 背包：所有物品的量化。不可见。
- 状态：指指令带来的状态改变或者是死亡、跳伞等特殊状态，可见。

特别的，还可以获得其他角色的ID。

### (*6*)职业

​	每一个AI在游戏开始前都应该选择一个职业决定自己角色的特殊属性，职业一旦选择不可更改，且同一支队伍AI不得选择重复的职业，玩家应当合理选择职业以组成强大的队伍。所有职业描述与特性如下：

#### a.医疗兵

简介：人在江湖走，哪能不挨刀？挨刀不要紧，我有医疗兵！医疗兵理应是团队不可缺少的一部分，能够携带药品，救治队友，甚至让HP降为0的队友获得新生。

特性：可以对队友使用药品（效果下降，见数据手册的技能参数）；可以对HP为0的队友使用药品以复活角色。

定位：奶妈

语录：“我还能再救一个！”

#### b.通信兵

简介：说好的团队作战，怎么又玩成个人英雄主义了？苟利队伍生死以，无论祸福我指挥！在这个神奇的世界通信兵能够使用255G波段的高频信号进行通信，避开干扰，从而更高效地传播信号。

特性：可以一帧内发送多条无线电。

定位：统领

语录：“嘀……嘀嘀嘀……嘀……嘀嘀嘀嘀……”

#### c.黑客

简介：那一天，我选择了该死的红色药丸，从此漫步在命运与虚实的谎言中……黑客拥有极高的软件能力，精通C++以外所有编程语言，能够使用四维传送门，解锁密码箱以获取高级装备。

特性：可以破解随机投放的密码箱并暴露出其中的装备。

定位：辅助

语录：“我深刻地怀疑我们所处的世界是二维的，到底是谁蒙蔽了我们的双眼？”

#### d.狙击手

简介：屏息，凝神，静候——一击必杀！狙击手精通狙击之道，善于用狙击枪进行弱点攻击，能够最大程度地发挥出狙击的作用。

特性：使用狙击枪时有伤害加成。

定位：输出

语录：“形神合一，攻敌一处。”

### (7)电圈

​	一个圆形的圈子会缓缓向圈内随机某个点缩进，这个圈子称为电圈，圈内区域是安全区，圈外区域是电区。电区内的玩家将持续受到伤害，电圈在一定时间后会坍塌到一个点（如果游戏能持续那么长时间的话），此时全图皆为电区。玩家需要在电圈向内缩进时和时间赛跑，在安全区内以保证生命安全。

​	电圈会以时间分段的模式移动，即匀速持续移动一段时间，再停滞一段时间，玩家每一帧会收到当前电圈的圆心、半径，下一状态电圈的圆心，半径，电圈是否在移动，以及变成下一状态（下次开始移动或下次停止移动）所需的帧数。

​	需要注意，一般玩家死亡时会处于假死状态，可以由医疗兵救活，但是一旦在电圈内HP为0，那么就会彻底死亡。(顺便补充一点，就算彻底死亡了也不会爆装备，但是击杀会有额外得分。)

注：为加快游戏进程，除了在电圈里会彻底死亡之外，如果队伍里所有人均为死亡/假死状态，也会被处理为全部死亡，因此此时该队伍已经没有回天之力。

### (8)逻辑顺序

1. 执行玩家指令
   - 拾取立刻执行，如果多人拾取统一物品只有一人会成功
   - 拾取成功后状态变为拾取
   - 移动指令仅仅做玩家移动方向改变，暂不移动
   - 攻击只刷新CD，保存指令信息，但是并未产生实际效果
   - 无线电消息发出，但是还未传播
2. 玩家移动
   - 玩家物理位置改变
   - 此阶段可能产生脚步声
3. 子弹飞行
   - 此阶段先刷新视野
   - 子弹均为瞬间击中，因此直接寻找击中对象或判定落空
4. 伤害结算
   - 将所有正负伤害进行累加计算
   - 药品效果也在此时发挥
   - 防弹衣效果发动，防弹衣耐久减少结算
   - 暂不考虑死亡（即一帧内子弹可能出现鞭尸）
5. 死亡结算
   - 电圈伤害也在此结算
   - 以伤害结算完后hp≤0作为假死依据
   - 真死判断也在此时进行
6. 物品信息刷新
   - 随机物品刷新在此阶段完成
7. 声音刷新
   - 只是声音的传播，产生不在此阶段
   - 若判定声音传到，则刷新玩家的声音列表
8. 玩家视野、cd等属性刷新
   - cd若减为0则产生相应效果
   - 玩家状态更新发生在此时
   - 若状态为拾取则在此阶段恢复正常(因此玩家不可能接收到自己的拾取状态)
   - 对于团灭的队伍，假死改为真死在此阶段进行

（规则解释权归电子系队式开发组所有！对上述规则解释有疑问可以联系逻辑组的饶淙元）

