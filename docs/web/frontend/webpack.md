---
title: Webpack
---

## å‰è¨€

æœ¬èŠ‚è¯¾çš„æœ€ç»ˆç›®çš„æ˜¯è®©å¤§å®¶å¯¹Webpackè¿™ä¸€æŠ€æœ¯æœ‰ä¸€ç®€å•çš„äº†è§£ä¸ç†è§£ï¼Œå¹¶åˆæ­¥å­¦ä¼šåº”ç”¨ã€‚æ¥ä¸‹æ¥ä¼šè®²ä¸€ç³»åˆ—Webpackçš„å‰ç½®çŸ¥è¯†ï¼Œåœ¨æœªæ¥å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç›´æ¥åº”ç”¨å®ƒä»¬ï¼Œä½†äº†è§£å®ƒä»¬æ˜¯æ€ä¹ˆå·¥ä½œçš„æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°è¿ç”¨Webpackã€‚

åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®²è®²å­¦ä¹ è¿™äº›çŸ¥è¯†çš„å¿…è¦æ€§ğŸ‘‡ã€‚

> å‰ç«¯é¡µé¢çš„å‘å±•
>
> * åŠ¨æ€é¡µé¢å®Œå…¨ç”±PHPç”Ÿæˆ
> * åŠ å…¥JSç‰‡æ®µè¾¾æˆæ›´å¥½çš„äº¤äº’
> * ä½¿ç”¨jQueryåŠå…¶æ’ä»¶
> * æ›´å¤šçš„åº“å’Œæ›´å¤šæ’ä»¶å¯ä»¥ç›´æ¥è°ƒç”¨

æˆ‘ä»¬çº¯çº¯åœ°åœ¨JSä¸­å¼•å…¥jQueryéœ€è¦æ€ä¹ˆåšå‘¢ï¼Ÿ

```html
<body>
<!--At the end of body block...-->
<script src="js/jquery.js"></script> <!--jQuery first-->
<script src="js/jquery.datepicker-zh-CN.min.js"></script>
<script src="js/jquery-ui.js"></script>
</body>
```

éœ€è¦å…³æ³¨å¼•å…¥ä½ç½®ã€å¼•å…¥é¡ºåºï¼Œç”šè‡³æ˜¯ä¸€äº›æ’ä»¶çš„è¿è¡Œæ—¶æœºã€‚

è€å¼çš„ä»»åŠ¡è¿è¡Œå™¨ï¼šHTMLã€cssã€JSä¸‰è€…å®Œå…¨åˆ†ç¦»ï¼Œç¨‹åºå‘˜éœ€è¦åˆ†åˆ«å…³æ³¨å’Œç®¡ç†æ¯ä¸€ä¸ªï¼Œæ›´éœ€è¦æ€è€ƒå¦‚ä½•ä½¿å®ƒä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è”åˆåœ¨ä¸€èµ·ã€‚

è¿™ä¸æ˜¯è½»æ¾æ„‰å¿«çš„æ´»ã€‚

èƒ½å¦è®©ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¾èµ–å…³ç³»ï¼Œåªæ ¹æ®æœ€ç»ˆéœ€æ±‚è‡ªæˆ‘æ„å»ºä¸è‡ªæˆ‘ç®¡ç†ï¼Ÿ

æ•¬è¯·æœŸå¾…ã€‚

:::tip

- æœ¬èŠ‚å†…å®¹åŠä¾‹ç¨‹å·²ä¸Šä¼ è‡³[Github ä»“åº“](https://github.com/chen-yy20/2022SummerTraining)ã€‚

:::

---

## CommonJS

Node.jsä»è¯ç”Ÿä»¥åä¾¿ç»ä¹…ä¸è¡°ï¼Œç¦»ä¸å¼€å®ƒæˆç†Ÿçš„æ¨¡å—åŒ–å®ç°ï¼Œè€ŒNode.jsçš„æ¨¡å—åŒ–æ˜¯åœ¨CommonJSè§„èŒƒçš„åŸºç¡€ä¸Šå®ç°çš„ã€‚

### æ˜¯ä»€ä¹ˆ

> ç»´åŸºç™¾ç§‘
>
> CommonJS æ˜¯ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ç›®æ ‡æ˜¯ä¸º JavaScript åœ¨ç½‘é¡µæµè§ˆå™¨ä¹‹å¤–åˆ›å»ºæ¨¡å—çº¦å®šã€‚åˆ›å»ºè¿™ä¸ªé¡¹ç›®çš„ä¸»è¦åŸå› æ˜¯å½“æ—¶ç¼ºä¹æ™®éå¯æ¥å—å½¢å¼çš„ JavaScript è„šæœ¬æ¨¡å—å•å…ƒï¼Œæ¨¡å—åœ¨ä¸è¿è¡ŒJavaScript è„šæœ¬çš„å¸¸è§„ç½‘é¡µæµè§ˆå™¨æ‰€æä¾›çš„ä¸åŒçš„ç¯å¢ƒä¸‹å¯ä»¥é‡å¤ä½¿ç”¨ã€‚

### å‰ç«¯æ¨¡å—åŒ–å‘å±•

JSæ¨¡å—åŒ–æ¦‚å¿µå¹¶éä¸ç”Ÿä¿±æ¥ã€‚ç›´åˆ°Node.jsçš„è¯ç”ŸæŠŠJSå¸¦åˆ°äº†æœåŠ¡ç«¯ï¼Œé¢å¯¹æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æ“ä½œç³»ç»Ÿç­‰å¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¨¡å—åŒ–æ‰é€æ¸å˜å¾—ä¸å¯æˆ–ç¼ºã€‚

![Webpack1](../assets/webpack_1.png)

ç”±æ­¤å¯è§ï¼ŒCommonJS æœ€åˆæ˜¯æœåŠ¡äºæœåŠ¡ç«¯çš„ï¼Œä½†å®ƒçš„è½½ä½“æ˜¯å‰ç«¯è¯­è¨€ JavaScriptï¼Œä¸ºåé¢å‰ç«¯æ¨¡å—åŒ–çš„ç››è¡Œäº§ç”Ÿäº†æ·±è¿œçš„å½±å“ï¼Œå¥ å®šäº†ç»“å®çš„åŸºç¡€ã€‚

JavaScript è¯ç”Ÿä¹‹åˆåªæ˜¯ä½œä¸ºä¸€ä¸ªè„šæœ¬è¯­è¨€æ¥ä½¿ç”¨ï¼Œåšä¸€äº›ç®€å•çš„è¡¨å•æ ¡éªŒç­‰ç­‰ã€‚æ‰€ä»¥ä»£ç é‡å¾ˆå°‘ï¼Œæœ€å¼€å§‹éƒ½æ˜¯ç›´æ¥å†™åˆ° `<script>` æ ‡ç­¾é‡Œï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```html
// index.html
<script>
    var name = 'morrain'
    var age = 18 
</script>
```

éšç€ä¸šåŠ¡è¿›ä¸€æ­¥å¤æ‚ï¼ŒAjax è¯ç”Ÿä»¥åï¼Œå‰ç«¯èƒ½åšçš„äº‹æƒ…è¶Šæ¥è¶Šå¤šï¼Œä»£ç é‡é£é€Ÿå¢é•¿ï¼Œå¼€å‘è€…ä»¬å¼€å§‹æŠŠ JavaScript å†™åˆ°ç‹¬ç«‹çš„ js æ–‡ä»¶ä¸­ï¼Œä¸ html æ–‡ä»¶è§£è€¦ã€‚åƒä¸‹é¢è¿™æ ·ï¼š

```html
// index.html
<script src="./mine.js"></script>

// mine.js
var name = 'morrain'
var age = 18
```

å†åæ¥ï¼Œæ›´å¤šçš„å¼€å‘è€…å‚ä¸è¿›æ¥ï¼Œæ›´å¤šçš„ js æ–‡ä»¶è¢«å¼•å…¥è¿›æ¥:

```html
// index.html
<script src="./mine.js"></script>
<script src="./a.js"></script>
<script src="./b.js"></script>
```

```javascript
// mine.js
var name = 'morrain'
var age = 18

// a.js
var name = 'lilei'
var age = 15

// b.js
var name = 'hanmeimei'
var age = 13
```

JavaScript åœ¨ ES6 ä¹‹å‰æ˜¯æ²¡æœ‰æ¨¡å—ç³»ç»Ÿï¼Œä¹Ÿæ²¡æœ‰å°é—­ä½œç”¨åŸŸçš„æ¦‚å¿µçš„ï¼Œæ‰€ä»¥ä¸Šé¢ä¸‰ä¸ª js æ–‡ä»¶é‡Œç”³æ˜çš„å˜é‡éƒ½ä¼šå­˜åœ¨äºå…¨å±€ä½œç”¨åŸŸä¸­ã€‚éšç€jsæ–‡ä»¶æ•°é‡ä¸å¤æ‚åº¦å¢åŠ ï¼Œè¶Šæ¥è¶Šå®¹æ˜“ä¸å…¶å®ƒ js æ–‡ä»¶å†²çªã€‚**å…¨å±€å˜é‡æ±¡æŸ“**å¼€å§‹æˆä¸ºå¼€å‘è€…çš„å™©æ¢¦ã€‚

**å‘½åç©ºé—´ï¼Ÿ**

å¼€å‘è€…å°è¯•ä½¿ç”¨å‘½åç©ºé—´æ¥è§£å†³å…¨å±€å˜é‡æ±¡æŸ“é—®é¢˜ã€‚

```html
// index.html
<script src="./mine.js"></script>
<script src="./a.js"></script>
<script src="./b.js"></script>
```

```javascript
// mine.js
app.mine = {}
app.mine.name = 'morrain'
app.mine.age = 18

// a.js
app.moduleA = {}
app.moduleA.name = 'lilei'
app.moduleA.age = 15

// b.js
app.moduleB = {}
app.moduleB.name = 'hanmeimei'
app.moduleB.age = 13
```

åœ¨æ­¤ï¼Œæ¨¡å—åŒ–çš„æ€æƒ³å·²ç»åˆç°ç«¯å€ªã€‚è¿™æ ·åœ¨ä¸€å®šç¨‹åº¦ä¸Šæ˜¯è§£å†³äº†å‘½åå†²çªçš„é—®é¢˜ï¼Œä½† b.js æ¨¡å—çš„å¼€å‘è€…ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡ `app.moduleA.name` æ¥å–åˆ°æ¨¡å—Aä¸­çš„åå­—ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥é€šè¿‡ `app.moduleA.name = 'rename'` æ¥ä»»æ„æ”¹æ‰æ¨¡å—Aä¸­çš„åå­—ï¼Œè€Œè¿™ä»¶äº‹æƒ…ï¼Œæ¨¡å—Aå´æ¯«ä¸çŸ¥æƒ…ï¼è¿™æ˜¾ç„¶æ˜¯ä¸è¢«å…è®¸çš„ã€‚

**å‡½æ•°ä½œç”¨åŸŸï¼Ÿ**

å¼€å‘è€…å°è¯•åˆ©ç”¨JSå‡½æ•°ä½œç”¨åŸŸçš„é—­åŒ…ç‰¹æ€§è§£å†³æ­¤é—®é¢˜ã€‚

```html
// index.html
<script src="./mine.js"></script>
<script src="./a.js"></script>
<script src="./b.js"></script>
```

```javascript
// mine.js
app.mine = (function(){
    var name = 'morrain'
    var age = 18
    return {
        getName: function(){
            return name
        }
    }
})()

// a.js
app.moduleA = (function(){
    var name = 'lilei'
    var age = 15
    return {
        getName: function(){
            return name
        }
    }
})()

// b.js
app.moduleB = (function(){
    var name = 'hanmeimei'
    var age = 13
    return {
        getName: function(){
            return name
        }
    }
})()
```

ç°åœ¨ b.js æ¨¡å—å¯ä»¥é€šè¿‡ `app.moduleA.getName()` æ¥å–åˆ°æ¨¡å—Açš„åå­—ï¼Œä½†æ˜¯å„ä¸ªæ¨¡å—çš„åå­—éƒ½ä¿å­˜åœ¨å„è‡ªçš„å‡½æ•°å†…éƒ¨ï¼Œæ²¡æœ‰åŠæ³•è¢«å…¶å®ƒæ¨¡å—æ›´æ”¹ã€‚

ä½†è¿™æ˜¾ç„¶ä¸å¤Ÿä¼˜é›…ï¼Œè€Œä¸”ä»æœ‰ä¸è¶³ã€‚è­¬å¦‚ä¸Šä¾‹ä¸­ï¼Œæ¨¡å—Bå¯ä»¥å–åˆ°æ¨¡å—Açš„ä¸œè¥¿ï¼Œä½†æ¨¡å—Aå´å–ä¸åˆ°æ¨¡å—Bçš„ï¼Œå› ä¸ºä¸Šé¢è¿™ä¸‰ä¸ªæ¨¡å—åŠ è½½æœ‰å…ˆåé¡ºåºï¼Œäº’ç›¸ä¾èµ–ã€‚å½“ä¸€ä¸ªå‰ç«¯åº”ç”¨ä¸šåŠ¡è§„æ¨¡è¶³å¤Ÿå¤§åï¼Œè¿™ç§ä¾èµ–å…³ç³»åˆå˜å¾—å¼‚å¸¸éš¾ä»¥ç»´æŠ¤ã€‚

**ç»¼ä¸Šæ‰€è¿°ï¼Œå‰ç«¯éœ€è¦æ¨¡å—åŒ–ï¼Œå¹¶ä¸”æ¨¡å—åŒ–ä¸å…‰è¦å¤„ç†å…¨å±€å˜é‡æ±¡æŸ“ã€æ•°æ®ä¿æŠ¤çš„é—®é¢˜ï¼Œè¿˜è¦å¾ˆå¥½çš„è§£å†³æ¨¡å—ä¹‹é—´ä¾èµ–å…³ç³»çš„ç»´æŠ¤ã€‚**

### CommonJSè§„èŒƒ

CommonJS å°±æ˜¯è§£å†³ä¸Šé¢é—®é¢˜çš„æ¨¡å—åŒ–è§„èŒƒï¼Œè§„èŒƒå°±å’Œç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ä¸€æ ·ï¼Œæ²¡æœ‰ä¸ºä»€ä¹ˆã€‚å½“å…¨ä¸–ç•Œçš„å¼€å‘è€…éƒ½éµå¾ªè¿™ä¸€è§„èŒƒæ—¶ï¼Œç”Ÿäº§åŠ›å°±å¤§å¤§æé«˜äº†ã€‚ğŸ‘‡

* Node.js åº”ç”¨ç”±æ¨¡å—ç»„æˆï¼Œæ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œæœ‰è‡ªå·±çš„ä½œç”¨åŸŸã€‚åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢å®šä¹‰çš„å˜é‡ã€å‡½æ•°ã€ç±»ï¼Œéƒ½æ˜¯ç§æœ‰çš„ï¼Œå¯¹å…¶ä»–æ–‡ä»¶ä¸å¯è§ã€‚

* æ¯ä¸ªæ¨¡å—å†…éƒ¨æœ‰ä¸¤ä¸ªå˜é‡å¯ä»¥ä½¿ç”¨ï¼Œ`require` å’Œ `module`ã€‚

  * `require` ç”¨æ¥åŠ è½½æŸä¸ªæ¨¡å—

  * `module` ä»£è¡¨å½“å‰æ¨¡å—ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¿å­˜äº†å½“å‰æ¨¡å—çš„ä¿¡æ¯ã€‚`exports` æ˜¯ `module` ä¸Šçš„ä¸€ä¸ª**å±æ€§**ï¼Œä¿å­˜äº†å½“å‰æ¨¡å—è¦å¯¼å‡ºçš„æ¥å£æˆ–è€…å˜é‡ï¼Œä½¿ç”¨ `require` åŠ è½½çš„æŸä¸ªæ¨¡å—è·å–åˆ°çš„å€¼å°±æ˜¯é‚£ä¸ªæ¨¡å—ä½¿ç”¨ `exports` **å¯¼å‡ºçš„å€¼**ã€‚

  ```javascript
  // a.js
  var name = 'morrain'
  var age = 18
  module.exports.name = name
  module.exports.getAge = function(){
      return age
  }
  
  //b.js
  var a = require('a.js')
  console.log(a.name) // 'morrain'
  console.log(a.getAge())// 18
  ```

åˆ°äº†ES6ï¼Œ`import`å’Œ`import(url)` è¿˜æœ‰`export`éƒ½è¢«æ”¯æŒäº†ã€‚å…¶ä¸­`import(url)`å‡½æ•°ä¼šè¿”å›ä¸€ä¸ª`promise`ã€‚

```javascript
import transform from './transform.js' /* default import */
import { var1 } from './consts.js' /* import a specific item */
import('http://example.com/example-module.js').then(() => { console.log('loaded') })
export const MODE = 'production' /* exported const *
```

---

## Babel

Babelå¯ä»¥æŠŠ JavaScript ä¸­ es2015/2016/2017 çš„æ–°è¯­æ³•è½¬åŒ–ä¸º es5ï¼Œè®©ä½ç«¯è¿è¡Œç¯å¢ƒ(å¦‚æµè§ˆå™¨å’Œ node )èƒ½å¤Ÿè®¤è¯†å¹¶æ‰§è¡Œï¼ŒES5çš„è§„èŒƒå¯ä»¥è¦†ç›–ç»å¤§éƒ¨åˆ†çš„æµè§ˆå™¨ï¼Œå› æ­¤æŠŠJSè½¬æ¢ä¸ºes5æ˜¯å®‰å…¨ä¸”æµè¡Œçš„åšæ³•ã€‚ï¼ˆæš‘åŸ¹æ‰€è®²æˆçš„JSè¯­æ³•åŸºäºES6ï¼Œå®é™…ä½¿ç”¨æ—¶ä¹Ÿæ˜¯ç»è¿‡äº†è½¬æ¢çš„ï¼‰

> ES6è¯­æ³•input
>
> ```javascript
> let test = { a: 1, b: 2 }
> const { a, b } = test
> console.log(a)
> ```
>
> ç»è¿‡babelåçš„IE6å¯ä»¥ç†è§£çš„output
>
> ```javascript
> "use strict";
> var test = { a: 1, b: 2 };
> var a = test.a, b = test.b;
> console.log(a)
> ```

### è¿è¡Œæ–¹å¼

babel æ€»å…±åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š**è§£æï¼Œè½¬æ¢ï¼Œç”Ÿæˆ**ã€‚

babel æœ¬èº«ä¸å…·æœ‰ä»»ä½•è½¬åŒ–åŠŸèƒ½ï¼Œå®ƒæŠŠè½¬åŒ–çš„åŠŸèƒ½éƒ½åˆ†è§£åˆ°ä¸€ä¸ªä¸ª plugin é‡Œé¢ã€‚å› æ­¤å½“æˆ‘ä»¬ä¸é…ç½®ä»»ä½•æ’ä»¶æ—¶ï¼Œç»è¿‡ babel çš„ä»£ç å’Œè¾“å…¥æ˜¯ç›¸åŒçš„ã€‚

æ’ä»¶æ€»å…±åˆ†ä¸ºä¸¤ç§ï¼š

- **è¯­æ³•æ’ä»¶** 

  åœ¨**è§£æ**è¿™ä¸€æ­¥ä½¿å¾— babel èƒ½å¤Ÿè§£ææ›´å¤šçš„è¯­æ³•ã€‚

  ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œå½“æˆ‘ä»¬å®šä¹‰æˆ–è€…è°ƒç”¨æ–¹æ³•æ—¶ï¼Œæœ€åä¸€ä¸ªå‚æ•°ä¹‹åæ˜¯ä¸å…è®¸å¢åŠ é€—å·çš„ï¼Œå¦‚ `callFoo(param1, param2,)` å°±æ˜¯éæ³•çš„ã€‚å¦‚æœæºç æ˜¯è¿™ç§å†™æ³•ï¼Œç»è¿‡ babel ä¹‹åå°±ä¼šæç¤ºè¯­æ³•é”™è¯¯ã€‚

  ä½†æœ€è¿‘çš„ JS ææ¡ˆä¸­å·²ç»å…è®¸äº†è¿™ç§æ–°çš„å†™æ³•(è®©ä»£ç  diff æ›´åŠ æ¸…æ™°)ã€‚ä¸ºäº†é¿å… babel æŠ¥é”™ï¼Œå°±éœ€è¦å¢åŠ è¯­æ³•æ’ä»¶ `babel-plugin-syntax-trailing-function-commas`

- **è½¬è¯‘æ’ä»¶**

  åœ¨**è½¬æ¢**è¿™ä¸€æ­¥æŠŠæºç æ›´å……åˆ†åœ°è½¬æ¢ã€‚

  æ¯”å¦‚ç®­å¤´å‡½æ•° `(a) => a` å°±ä¼šè½¬åŒ–ä¸º `function (a) {return a}`ã€‚å®Œæˆè¿™ä¸ªå·¥ä½œçš„æ’ä»¶å«åš `babel-plugin-transform-es2015-arrow-functions`ã€‚

åŒä¸€ç±»è¯­æ³•å¯èƒ½åŒæ—¶å­˜åœ¨è¯­æ³•æ’ä»¶ç‰ˆæœ¬å’Œè½¬è¯‘æ’ä»¶ç‰ˆæœ¬ã€‚**å¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†è½¬è¯‘æ’ä»¶ï¼Œå°±ä¸ç”¨å†ä½¿ç”¨è¯­æ³•æ’ä»¶äº†ã€‚**

### å®‰è£…plugin

æ—¢ç„¶æ’ä»¶æ˜¯ babel çš„æ ¹æœ¬ï¼Œé‚£å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿæ€»å…±åˆ†ä¸º 2 ä¸ªæ­¥éª¤ï¼š

1. å°†æ’ä»¶çš„åå­—å¢åŠ åˆ°é…ç½®æ–‡ä»¶ä¸­ (æ ¹ç›®å½•ä¸‹åˆ›å»º .babelrc æˆ–è€… package.json çš„ `babel` é‡Œé¢ï¼Œæ ¼å¼ç›¸åŒ)
2. ä½¿ç”¨ `npm install babel-plugin-xxx` è¿›è¡Œå®‰è£…

### ä½¿ç”¨preset

æ¯”å¦‚è¯´ï¼ŒES6 æ˜¯ä¸€å¥—è§„èŒƒï¼ŒåŒ…å«å¤§æ¦‚åå‡ äºŒåä¸ªè½¬è¯‘æ’ä»¶ã€‚å¦‚æœæ¯æ¬¡è¦å¼€å‘è€…ä¸€ä¸ªä¸ªæ·»åŠ å¹¶å®‰è£…ï¼Œé…ç½®æ–‡ä»¶å¾ˆé•¿ä¸è¯´ï¼Œ`npm install` çš„æ—¶é—´ä¹Ÿä¼šå¾ˆé•¿ï¼Œæ›´ä¸è°ˆæˆ‘ä»¬å¯èƒ½è¿˜è¦åŒæ—¶ä½¿ç”¨å…¶ä»–è§„èŒƒå‘¢ã€‚

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œbabel è¿˜æä¾›äº†ä¸€ç»„æ’ä»¶çš„é›†åˆã€‚å› ä¸ºå¸¸ç”¨ï¼Œæ‰€ä»¥ä¸å¿…é‡å¤å®šä¹‰ & å®‰è£…ã€‚(å•ç‚¹å’Œå¥—é¤çš„å·®åˆ«ï¼Œå¥—é¤çœä¸‹äº†å·¨å¤šçš„æ—¶é—´å’Œé…ç½®çš„ç²¾åŠ›)

### é…ç½®

ç®€ç•¥æƒ…å†µä¸‹ï¼Œæ’ä»¶å’Œ preset åªè¦åˆ—å‡ºå­—ç¬¦ä¸²æ ¼å¼çš„åå­—å³å¯ã€‚ä½†å¦‚æœæŸä¸ª preset æˆ–è€…æ’ä»¶éœ€è¦ä¸€äº›é…ç½®é¡¹(æˆ–è€…è¯´å‚æ•°)ï¼Œå°±éœ€è¦æŠŠè‡ªå·±å…ˆå˜æˆæ•°ç»„ã€‚ç¬¬ä¸€ä¸ªå…ƒç´ ä¾ç„¶æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºè‡ªå·±çš„åå­—ï¼›ç¬¬äºŒä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå³é…ç½®å¯¹è±¡ã€‚(åé¢ç»†å—¦)

### env

env å¯ä»¥è¯´æ˜¯æœ€ä¸ºå¸¸ç”¨ä¹Ÿæœ€é‡è¦çš„é…ç½®é¡¹ã€‚

env çš„æ ¸å¿ƒç›®çš„æ˜¯é€šè¿‡é…ç½®å¾—çŸ¥ç›®æ ‡ç¯å¢ƒçš„ç‰¹ç‚¹ï¼Œç„¶ååªåšå¿…è¦çš„è½¬æ¢ã€‚ä¾‹å¦‚ç›®æ ‡æµè§ˆå™¨æ”¯æŒ es2015ï¼Œé‚£ä¹ˆ es2015 è¿™ä¸ª preset å…¶å®æ˜¯ä¸éœ€è¦çš„ï¼Œå‡å°è½¬åŒ–åä»£ç ä½“ç§¯(ä¸€èˆ¬è½¬åŒ–åçš„ä»£ç æ€»æ˜¯æ›´é•¿)ï¼Œæ„å»ºæ—¶é—´ä¹Ÿå¯ä»¥ç¼©çŸ­ä¸€äº›ã€‚

å¦‚æœä¸å†™ä»»ä½•é…ç½®é¡¹ï¼Œenv ç­‰ä»·äº latestï¼Œä¹Ÿç­‰ä»·äº es2015 + es2016 + es2017 ä¸‰ä¸ªç›¸åŠ ã€‚env åŒ…å«çš„æ’ä»¶åˆ—è¡¨ç»´æŠ¤åœ¨[è¿™é‡Œ](https://link.zhihu.com/?target=https%3A//github.com/babel/babel-preset-env/blob/master/data/plugin-features.js)

ä¸‹é¢åˆ—å‡ºå‡ ç§æ¯”è¾ƒå¸¸ç”¨çš„é…ç½®æ–¹æ³•ï¼š

```json
{
  "presets": [
    ["env", {
      "targets": {
        "browsers": ["last 2 versions", "safari >= 7"]
      }
    }]
  ]
}
```

å¦‚ä¸Šé…ç½®å°†è€ƒè™‘æ‰€æœ‰æµè§ˆå™¨çš„æœ€æ–°2ä¸ªç‰ˆæœ¬(safariå¤§äºç­‰äº7.0çš„ç‰ˆæœ¬)çš„ç‰¹æ€§ï¼Œå°†å¿…è¦çš„ä»£ç è¿›è¡Œè½¬æ¢ã€‚è€Œè¿™äº›ç‰ˆæœ¬å·²æœ‰çš„åŠŸèƒ½å°±ä¸è¿›è¡Œè½¬åŒ–äº†ã€‚

```json
{
  "presets": [
    ["env", {
      "targets": {
        "node": "6.10"
      }
    }]
  ]
}
```

å¦‚ä¸Šé…ç½®å°†ç›®æ ‡è®¾ç½®ä¸º nodejsï¼Œå¹¶ä¸”æ”¯æŒ 6.10 åŠä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ `node: 'current'` æ¥æ”¯æŒæœ€æ–°ç¨³å®šç‰ˆæœ¬ã€‚ä¾‹å¦‚ç®­å¤´å‡½æ•°åœ¨ nodejs 6 åŠä»¥ä¸Šå°†ä¸è¢«è½¬åŒ–ï¼Œä½†å¦‚æœæ˜¯ nodejs 0.12 å°±ä¼šè¢«è½¬åŒ–äº†ã€‚

### Polyfill

Polyfill æ˜¯ä¸€å—ä»£ç ï¼ˆé€šå¸¸æ˜¯ Web ä¸Šçš„ JavaScriptï¼‰ï¼Œç”¨æ¥ä¸ºæ—§æµè§ˆå™¨æä¾›å®ƒæ²¡æœ‰åŸç”Ÿæ”¯æŒçš„è¾ƒæ–°çš„åŠŸèƒ½ï¼Œå¯ä»¥ç†è§£ä¸ºâ€œè¡¥ä¸â€ã€‚

æ¯”å¦‚è¯´ï¼Œæ‰€æœ‰ç‰ˆæœ¬çš„IEæµè§ˆå™¨éƒ½ä¸æ”¯æŒ`Promise`çš„APIï¼Œé‚£æˆ‘ä»¬å°±æ²¡åŠæ³•åœ¨IEä¸Šè¿è¡Œå¸¦æœ‰Promiseçš„JSä»£ç äº†å—ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Polyfillå»ä¿®å¤æ­¤åŠŸèƒ½ã€‚è¿™ä¸babelçš„è½¬ç æœ‰ä¸€å®šçš„ä¸åŒï¼Œbabel é»˜è®¤åªè½¬æ¢ js è¯­æ³•ï¼Œè€Œä¸è½¬æ¢æ–°çš„ APIï¼Œæ¯”å¦‚ Iteratorã€Generatorã€Setã€Mapsã€Proxyã€Reflectã€Symbolã€Promise ç­‰å…¨å±€å¯¹è±¡ï¼Œä»¥åŠä¸€äº›å®šä¹‰åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•(æ¯”å¦‚ `Object.assign`)éƒ½ä¸ä¼šè½¬ç ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œes2015 åœ¨ Array å¯¹è±¡ä¸Šæ–°å¢äº† `Array.from` æ–¹æ³•ã€‚babel å°±ä¸ä¼šè½¬ç è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœæƒ³è®©è¿™ä¸ªæ–¹æ³•è¿è¡Œï¼Œå¿…é¡»ä½¿ç”¨ `babel-polyfill`ã€‚(å†…éƒ¨é›†æˆäº† `core-js` å’Œ `regenerator`)ã€‚

> core-jsæ˜¯å®Œå…¨æ¨¡å—åŒ–çš„javascriptæ ‡å‡†åº“ã€‚ åŒ…å«ECMA-262è‡³ä»Šä¸ºæ­¢å¤§éƒ¨åˆ†ç‰¹æ€§çš„polyfillï¼Œå¦‚promisesã€symbolsã€collectionsã€iteratorsã€typed arraysã€etcï¼Œä»¥åŠä¸€äº›è·¨å¹³å°çš„WHATWG / W3Cç‰¹æ€§çš„polyfillï¼Œå¦‚WHATWG URLã€‚ å®ƒå¯ä»¥ç›´æ¥å…¨éƒ¨æ³¨å…¥åˆ°å…¨å±€ç¯å¢ƒé‡Œé¢ï¼Œå¸®åŠ©å¼€å‘è€…æ¨¡æ‹Ÿä¸€ä¸ªåŒ…å«ä¼—å¤šæ–°ç‰¹æ€§çš„è¿è¡Œç¯å¢ƒï¼Œè¿™æ ·å¼€å‘è€…ä»…éœ€ç®€å•å¼•å…¥core-jsï¼Œä»ç„¶ä½¿ç”¨æœ€æ–°ç‰¹æ€§çš„ESå†™æ³•ç¼–ç å³å¯ï¼›ä¹Ÿå¯ä»¥ä¸ç›´æ¥æ³¨å…¥åˆ°å…¨å±€å¯¹è±¡é‡Œé¢ã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œå…¨æ¨¡å—åŒ–çš„åº“ï¼Œæ‰€æœ‰çš„polyfillå®ç°ï¼Œéƒ½æœ‰ä¸€ä¸ªå•ç‹¬çš„moduleæ–‡ä»¶ï¼Œæ—¢å¯ä»¥ä¸€åŠ³æ°¸é€¸åœ°æŠŠæ‰€æœ‰polyfillå…¨éƒ¨å¼•å…¥ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ï¼Œåœ¨è‡ªå·±é¡¹ç›®çš„æ¯ä¸ªæ–‡ä»¶ï¼Œå•ç‹¬å¼•å…¥éœ€è¦çš„core-jsçš„modulesæ–‡ä»¶ã€‚

![Webpack2](../assets/webpack_2.png)

---

## Webpack

åƒå‘¼ä¸‡å”¤å§‹å‡ºæ¥ï¼Œæˆ‘ä»¬ç»ˆäºè¦å¼€å§‹è®²é»‘é­”æ³•Webpackäº†ï¼

### æ˜¯ä»€ä¹ˆ

Webpackæ˜¯ä¸€ä¸ªæ¨¡å—æ‰“åŒ…å™¨ï¼Œä¸»è¦ç›®æ ‡æ˜¯æŠŠæ‚ä¹±æ— ç« çš„JavaScriptæ–‡ä»¶(ä»¥åŠå…¶ä»–å„ç§ç±»å‹çš„èµ„æºæ–‡ä»¶)æ‰“åŒ…åœ¨ä¸€èµ·ã€‚ä½¿å¾—ç»“æ„å˜å¾—ç®€å•ï¼Œå‡è½»ç¨‹åºå‘˜çš„è´Ÿæ‹…ã€‚

> å®˜æ–¹æ–‡æ¡£ï¼šWebpack æ˜¯å½“ä¸‹æœ€çƒ­é—¨çš„å‰ç«¯èµ„æºæ¨¡å—åŒ–ç®¡ç†å’Œæ‰“åŒ…å·¥å…·ã€‚å®ƒå¯ä»¥å°†è®¸å¤šæ¾æ•£çš„æ¨¡å—æŒ‰ç…§ä¾èµ–å’Œè§„åˆ™æ‰“åŒ…æˆç¬¦åˆç”Ÿäº§ç¯å¢ƒéƒ¨ç½²çš„å‰ç«¯èµ„æºã€‚è¿˜å¯ä»¥å°†æŒ‰éœ€åŠ è½½çš„æ¨¡å—è¿›è¡Œä»£ç åˆ†éš”ï¼Œç­‰åˆ°å®é™…éœ€è¦çš„æ—¶å€™å†å¼‚æ­¥åŠ è½½ã€‚
>
> é€šè¿‡ loader çš„è½¬æ¢ï¼Œä»»ä½•å½¢å¼çš„èµ„æºéƒ½å¯ä»¥è§†ä½œæ¨¡å—ï¼Œæ¯”å¦‚ CommonJs æ¨¡å—ã€ AMD æ¨¡å—ã€ ES6 æ¨¡å—ã€CSSã€å›¾ç‰‡ã€ JSONã€Coffeescriptã€ LESS ç­‰ã€‚
>
> ![webpack æ¦‚è¿°](https://webpack.html.cn/img/webpack.png)

### ä¸ºä»€ä¹ˆä½¿ç”¨Webpack

å‰æ–‡å·²è¿°ã€‚

Webpackç»™å‡ºä¸€ç§è§£å†³æ–¹å¼ï¼šå¦‚æœ Webpack äº†è§£ä¾èµ–å…³ç³»ï¼Œå®ƒä¼šä»…æ†ç»‘æˆ‘ä»¬åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®é™…éœ€è¦çš„éƒ¨åˆ†ã€‚æˆ‘ä»¬é€šè¿‡ JavaScript å‘webpackä¼ é€’ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ„å»ºè¿‡ç¨‹æ›´åŠ å®¹æ˜“ã€‚

æ¢å¥è¯è¯´ï¼šä½ åªéœ€è¦æŠŠé¡¹ç›®ä»£ç **å†™æ˜ç™½**ï¼Œå¹¶åŠ ä»¥é€‚å½“çš„**é…ç½®**ï¼ŒWebpackå°±ä¼šè‡ªåŠ¨æŒç»­åœ°å·¥ä½œã€‚

### å¦‚ä½•ä½¿ç”¨Webpack

æœ¬è´¨ä¸Šï¼Œ*webpack* æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„**é™æ€æ¨¡å—æ‰“åŒ…å™¨(module bundler)**ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šé€’å½’åœ°æ„å»ºä¸€ä¸ª**ä¾èµ–å…³ç³»å›¾(dependency graph)**ï¼Œå…¶ä¸­åŒ…å«åº”ç”¨ç¨‹åºéœ€è¦çš„æ¯ä¸ªæ¨¡å—ï¼Œç„¶åå°†æ‰€æœ‰è¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ª *bundle*ã€‚

#### é…ç½®

ä» webpack v4.0.0 å¼€å§‹ï¼Œå¯ä»¥ä¸ç”¨å¼•å…¥é…ç½®æ–‡ä»¶ã€‚ç„¶è€Œï¼Œwebpack ä»ç„¶è¿˜æ˜¯[é«˜åº¦å¯é…ç½®çš„](https://webpack.html.cn/configuration)ã€‚

##### æ ¸å¿ƒæ¦‚å¿µ

å…³äºWebpacké…ç½®ï¼Œå…ˆç†è§£å››ä¸ª**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

* **å…¥å£ï¼ˆentryï¼‰**

  **å…¥å£èµ·ç‚¹(entry point)**æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚

  æ¯ä¸ªä¾èµ–é¡¹éšå³è¢«å¤„ç†ï¼Œæœ€åè¾“å‡ºåˆ°ç§°ä¹‹ä¸º *bundles* çš„æ–‡ä»¶ä¸­ã€‚

* **å‡ºå£ï¼ˆoutputï¼‰**

  **output** å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ *bundles*ï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ï¼Œé»˜è®¤å€¼ä¸º `./dist`ã€‚åŸºæœ¬ä¸Šï¼Œæ•´ä¸ªåº”ç”¨ç¨‹åºç»“æ„ï¼Œéƒ½ä¼šè¢«ç¼–è¯‘åˆ°ä½ æŒ‡å®šçš„è¾“å‡ºè·¯å¾„çš„æ–‡ä»¶å¤¹ä¸­ã€‚

* **åŠ è½½å™¨ï¼ˆloaderï¼‰**

  **loader** è®© webpack èƒ½å¤Ÿå»å¤„ç†é‚£äº›é JavaScript æ–‡ä»¶ï¼ˆwebpack è‡ªèº«åªç†è§£ JavaScriptï¼‰ã€‚loader å¯ä»¥å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶è½¬æ¢ä¸º webpack èƒ½å¤Ÿå¤„ç†çš„æœ‰æ•ˆ[æ¨¡å—](https://webpack.html.cn/concepts/modules)ï¼Œç„¶åä½ å°±å¯ä»¥åˆ©ç”¨ webpack çš„æ‰“åŒ…èƒ½åŠ›ï¼Œå¯¹å®ƒä»¬è¿›è¡Œå¤„ç†ã€‚

  æœ¬è´¨ä¸Šï¼Œwebpack loader å°†æ‰€æœ‰ç±»å‹çš„æ–‡ä»¶ï¼Œè½¬æ¢ä¸ºåº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ï¼ˆå’Œæœ€ç»ˆçš„ bundleï¼‰å¯ä»¥ç›´æ¥å¼•ç”¨çš„æ¨¡å—ã€‚

* **æ’ä»¶ï¼ˆpluginsï¼‰**

  loader è¢«ç”¨äºè½¬æ¢æŸäº›ç±»å‹çš„æ¨¡å—ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚æ’ä»¶çš„èŒƒå›´åŒ…æ‹¬ï¼Œä»æ‰“åŒ…ä¼˜åŒ–å’Œå‹ç¼©ï¼Œä¸€ç›´åˆ°é‡æ–°å®šä¹‰ç¯å¢ƒä¸­çš„å˜é‡ã€‚[æ’ä»¶æ¥å£](https://webpack.html.cn/api/plugins)åŠŸèƒ½æå…¶å¼ºå¤§ï¼Œå¯ä»¥ç”¨æ¥å¤„ç†å„ç§å„æ ·çš„ä»»åŠ¡ã€‚

  æƒ³è¦ä½¿ç”¨ä¸€ä¸ªæ’ä»¶ï¼Œä½ åªéœ€è¦ `require()` å®ƒï¼Œç„¶åæŠŠå®ƒæ·»åŠ åˆ° `plugins` æ•°ç»„ä¸­ã€‚`new`å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªæˆ–å¤šä¸ªæ’ä»¶ã€‚

  > webpack å¼€ç®±å¯ç”¨æ’ä»¶åˆ—è¡¨ï¼š[æ’ä»¶åˆ—è¡¨](https://webpack.html.cn/plugins)


##### é…ç½®æ–‡ä»¶å®ä¾‹

**webpack.config.js**

```javascript
const HtmlWebpackPlugin = require('html-webpack-plugin'); // é€šè¿‡ npm å®‰è£…
const path = require('path');
const webpack = require('webpack'); // ç”¨äºè®¿é—®å†…ç½®æ’ä»¶

const config = {
  entry:'./path/to/my/entry/file.js', // å…¥å£æ–‡ä»¶ç»å¯¹è·¯å¾„
  output: {
    path: path.resolve(__dirname, 'dist'), // è¾“å‡ºç›®å½•ç»å¯¹è·¯å¾„
    filename: 'my-first-webpack.bundle.js' // è¾“å‡ºæ–‡ä»¶å
  },
  module: {
    rules: [
      { test: /\.txt$/, use: 'raw-loader' }
    ]
  },
  plugins: [
    new webpack.optimize.UglifyJsPlugin(),
    new HtmlWebpackPlugin({template: './src/index.html'})
  ]
};

module.exports = config; // 
```

## è§†é¢‘æ•™ç¨‹

### 2022 å¹´æš‘æœŸåŸ¹è®­

import Video from '@site/src/component/video_player';

**Node, Babel, CommonJS**
<Video url="https://cloud.tsinghua.edu.cn/d/0d8895f41a4a4dcaa0a4/files/?p=%2F%E5%9B%9E%E6%94%BE%2F10.Node%20babel%20commonjs%20.mp4" source="THU"/><br/>

**Webpack**
<Video url="https://cloud.tsinghua.edu.cn/d/0d8895f41a4a4dcaa0a4/files/?p=%2F%E5%9B%9E%E6%94%BE%2F10.webpack.mp4" source="THU"/>